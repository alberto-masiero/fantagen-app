<ion-header class="formation-header">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button fill="clear" (click)="goSelect()">
        <ion-icon name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>

    <ion-title>Formazione</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="formation-content">

  <!-- HERO sticky stile Select -->
  <div class="formation-hero">
    <!-- <div class="hero-top">
      <div class="hero-title">
        <div class="h1">Formazione</div>
        <div class="h2">Scegli il modulo e visualizza l’XI migliore</div>
      </div>

      <ion-button class="btn-ghost" fill="clear" size="small" (click)="goSelect()">
        Modifica rosa
      </ion-button>
    </div> -->

    <!-- Modulo (segment in stile pill) -->
    <div class="hero-module">
      <ion-segment class="seg-pills"
        [value]="module()"
        (ionChange)="onModuleChange($event)">
       <ion-segment class="seg-pills"
  [value]="module()"
  (ionChange)="onModuleChange($event)">

  <ion-segment-button value="4-4-2">
    <ion-label class="mod-pill">
      <span class="mini mini-442" aria-hidden="true"></span>
      <span class="txt">4-4-2</span>
    </ion-label>
  </ion-segment-button>

  <ion-segment-button value="4-3-3">
    <ion-label class="mod-pill">
      <span class="mini mini-433" aria-hidden="true"></span>
      <span class="txt">4-3-3</span>
    </ion-label>
  </ion-segment-button>

  <ion-segment-button value="4-5-1">
    <ion-label class="mod-pill">
      <span class="mini mini-451" aria-hidden="true"></span>
      <span class="txt">4-5-1</span>
    </ion-label>
  </ion-segment-button>

  <ion-segment-button value="3-4-3">
    <ion-label class="mod-pill">
      <span class="mini mini-343" aria-hidden="true"></span>
      <span class="txt">3-4-3</span>
    </ion-label>
  </ion-segment-button>

  <ion-segment-button value="3-5-2">
    <ion-label class="mod-pill">
      <span class="mini mini-352" aria-hidden="true"></span>
      <span class="txt">3-5-2</span>
    </ion-label>
  </ion-segment-button>

  <ion-segment-button value="5-3-2">
    <ion-label class="mod-pill">
      <span class="mini mini-532" aria-hidden="true"></span>
      <span class="txt">5-3-2</span>
    </ion-label>
  </ion-segment-button>

  <ion-segment-button value="5-4-1">
    <ion-label class="mod-pill">
      <span class="mini mini-541" aria-hidden="true"></span>
      <span class="txt">5-4-1</span>
    </ion-label>
  </ion-segment-button>

</ion-segment>

      </ion-segment>
    </div>
  </div>

  <!-- CONTENT -->
  <div class="formation-wrap">

    <!-- CARD PITCH -->
    <div class="card pitch-card">
      <app-pitch
        [module]="module()"
        [starters]="starters()">
      </app-pitch>
    </div>

    <!-- CARD BENCH -->
    <div class="card bench-card">
      <div class="card-head">
        <div class="card-title">Panchina</div>
        <div class="card-sub">{{ bench().length }} giocatori</div>
      </div>

<div class="bench-grid">
  <div class="bench-item" *ngFor="let p of bench()">
    <div class="bench-left">
      <div class="logo-wrap">
        <img *ngIf="p.teamLogo" class="team-logo" [src]="p.teamLogo" [alt]="p.team ?? 'team'">
        <div *ngIf="!p.teamLogo" class="team-fallback">{{ (p.team ?? '?') | slice:0:3 }}</div>
      </div>
    </div>

   <div class="bench-mid">
  <div class="bench-name">{{ p.name }}</div>
  <div class="bench-team">{{ p.team }}</div>

  <!-- trend + MV -->
  <div class="bench-meta">
    <div class="bench-mv">MV {{ p.rating | number:'1.2-2' }}</div>

    <div class="bench-trend"
         [class.up]="p.trend === '+'"
         [class.down]="p.trend === '-'"
         [class.eq]="p.trend === '='">
      <span *ngIf="p.trend === '+'">▲</span>
      <span *ngIf="p.trend === '-'">▼</span>
      <span *ngIf="p.trend === '='">—</span>
    </div>
  </div>

  <!-- TIT progress -->
  <div class="bench-progress" *ngIf="p.Tit !== 'I' && p.Tit !== 'S'">
    <div class="tit-bar bench-tit-bar">
      <div class="tit-fill"
           [style.width.%]="p.Tit"
           [class.low]="p.Tit! < 40"
           [class.mid]="p.Tit! >= 40 && p.Tit! < 70"
           [class.high]="p.Tit! >= 70">
      </div>
    </div>

    <!-- opzionale: percentuale in piccolo -->
    <div class="bench-tit-txt">{{ p.Tit | number:'1.0-0' }}%</div>
  </div>

  <!-- flag -->
  <div class="bench-progress" *ngIf="p.Tit === 'I' || p.Tit === 'S'">
    <div class="flag bench-flag"
         [class.inj]="p.Tit === 'I'"
         [class.sus]="p.Tit === 'S'">
      {{ p.Tit === 'I' ? 'Infortunato' : 'Squalificato' }}
    </div>
  </div>
</div>


    <div class="bench-right">
      <div class="pill role">{{ p.role }}</div>
      <div class="pill rating">{{ p.rating }}</div>
    </div>
  </div>
</div>

    </div>

    <!-- Spacer per fondo -->
    <div class="bottom-spacer"></div>
  </div>

</ion-content>
